{% include "app/inc/header.html" with title="Dataset" icon="subject" d3js="true" %}

<div class="sub-content">

    <div class="actions">
        <a href="/app/interactions/?id={{metadata.id}}"><i class="material-icons">bubble_chart</i>Visualize interactions</a>
    </div>



    <div class="kpis">
        <div class="sub-content">
            <div class="item active" id="tweets">
                <div class="previous">{{ stats.tweets_count_variation }}</div>
                <div class="count">{{ stats.current_tweets_count }}</div>
                <div class="label">tweets</div>
            </div><!--
                --><div class="item" id="users">
            <div class="previous">{{ stats.tweets_users_variation }}</div>
            <div class="count">{{ stats.current_users_count }}</div>
            <div class="label">users</div>
        </div><!--
                --><div class="item" id="interactions">
            <div class="previous">{{ stats.tweets_interactions_variation }}</div>
            <div class="count">{{ stats.current_interactions_count }}</div>
            <div class="label">interactions</div>
        </div><!--
                --><div class="item" id="density">
            <div class="previous">-2</div>
            <div class="count">0.4%</div>
            <div class="label">density</div>
        </div><!--
                --><div class="item" id="sentiment">
            <div class="previous">6</div>
            <div class="count">+72</div>
            <div class="label">sentiment</div>
        </div>
    </div>
</div>

<div class="line-chart">
    <div class="sub-title">Tweets</div>

    <svg id="graph"></svg>

    <div class="caption">
        <span class="current">
            <svg height="8" width="16"><line x1="0" y1="4" x2="16" y2="4" style="stroke:#3498db;stroke-width:2" /></svg> Timeframe selected
        </span><span class="spacer"></span>
        <span class="previous">
            <svg height="8" width="16"><line x1="0" y1="4" x2="16" y2="4" style="stroke:#3498db;stroke-width:2;stroke-dasharray:3,1" /></svg>Comparison period
        </span>
    </div>
</div>

</div>

</div>

</div>

<script>

    var data = {{ detailed_stats|safe }};

    var parseTime = d3.timeParse("%Y-%m-%d %H:%M");
    data.forEach(function(d) {
        d.current_timeframe = parseTime(d.current_timeframe);
        d.previous_timeframe = parseTime(d.previous_timeframe);
    });

    draw(data, "tweets");

    $(document).ready(function() {

        $(".kpis .item").click(function() {
            $(".kpis .item").each( function () {
                $(this).removeClass("active");
            });
            $(this).addClass("active");
            $(".line-chart #graph").html("");
            $(".line-chart .sub-title").text($(this).attr('id').charAt(0).toUpperCase() + $(this).attr('id').slice(1));
            draw(data, $(this).attr('id'));
        });

    });

</script>

</body>
</html>